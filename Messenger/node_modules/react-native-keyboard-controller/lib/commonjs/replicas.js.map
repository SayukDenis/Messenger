{"version":3,"names":["_react","require","_reactNative","_reactNativeReanimated","_bindings","_constants","_hooks","availableOSEventType","Platform","OS","defaultAndroidEasing","Easing","bezier","exports","useKeyboardAnimationReplica","height","useRef","Animated","Value","progress","animation","useMemo","current","useEffect","KeyboardController","setInputMode","AndroidSoftInputModes","SOFT_INPUT_ADJUST_RESIZE","setDefaultMode","listener","Keyboard","addListener","e","timing","toValue","endCoordinates","duration","easing","useNativeDriver","start","remove","IOS_SPRING_CONFIG","damping","stiffness","mass","overshootClamping","restDisplacementThreshold","restSpeedThreshold","useReanimatedKeyboardAnimationReplica","useSharedValue","heightEvent","useDerivedValue","value","handler","useCallback","_height","useAnimatedReaction","_keyboardHeight","result","_previousResult","_previousKeyboardHeight","withSpring","show","runOnUI","hide","useGradualKeyboardAnimation","useReanimatedKeyboardAnimation"],"sources":["replicas.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { Animated, Easing, Keyboard, Platform } from \"react-native\";\nimport {\n  runOnUI,\n  useAnimatedReaction,\n  useDerivedValue,\n  useSharedValue,\n  withSpring,\n} from \"react-native-reanimated\";\n\nimport { KeyboardController } from \"./bindings\";\nimport { AndroidSoftInputModes } from \"./constants\";\nimport { useReanimatedKeyboardAnimation } from \"./hooks\";\n\nconst availableOSEventType = Platform.OS === \"ios\" ? \"Will\" : \"Did\";\n\n// cubic-bezier(.17,.67,.34,.94)\nexport const defaultAndroidEasing = Easing.bezier(0.4, 0.0, 0.2, 1);\ntype KeyboardAnimation = {\n  progress: Animated.Value;\n  height: Animated.Value;\n};\n\n/**\n * An experimental implementation of tracing keyboard appearance.\n * Switch an input mode to adjust resize mode. In this case all did* events\n * are triggering before keyboard appears, and using some approximations\n * it tries to mimicries a native transition.\n *\n * @returns {Animated.Value}\n */\nexport const useKeyboardAnimationReplica = (): KeyboardAnimation => {\n  const height = useRef(new Animated.Value(0));\n  const progress = useRef(new Animated.Value(0));\n  const animation = useMemo(\n    () => ({\n      height: height.current,\n      progress: progress.current,\n    }),\n    [],\n  );\n\n  useEffect(() => {\n    KeyboardController.setInputMode(\n      AndroidSoftInputModes.SOFT_INPUT_ADJUST_RESIZE,\n    );\n\n    return () => KeyboardController.setDefaultMode();\n  }, []);\n  useEffect(() => {\n    const listener = Keyboard.addListener(\n      `keyboard${availableOSEventType}Show`,\n      (e) => {\n        Animated.timing(height.current, {\n          toValue: -e.endCoordinates.height,\n          duration: e.duration !== 0 ? e.duration : 300,\n          easing: Easing.bezier(0.4, 0.0, 0.2, 1),\n          useNativeDriver: true,\n        }).start();\n\n        return () => listener.remove();\n      },\n    );\n  }, []);\n  useEffect(() => {\n    const listener = Keyboard.addListener(\n      `keyboard${availableOSEventType}Hide`,\n      (e) => {\n        Animated.timing(height.current, {\n          toValue: 0,\n          duration: e.duration !== 0 ? e.duration : 300,\n          easing: Easing.bezier(0.4, 0.0, 0.2, 1),\n          useNativeDriver: true,\n        }).start();\n\n        return () => listener.remove();\n      },\n    );\n  }, []);\n\n  return animation;\n};\n\nconst IOS_SPRING_CONFIG = {\n  damping: 500,\n  stiffness: 1000,\n  mass: 3,\n  overshootClamping: true,\n  restDisplacementThreshold: 10,\n  restSpeedThreshold: 10,\n};\n\n/**\n * A close replica to native iOS keyboard animation. The problem is that\n * iOS (unlike Android) can not fire events for each keyboard frame movement.\n * As a result we can not get gradual values (for example, for progress it always\n * will be 1 or 0). So if you want to rely on gradual values you will need to use\n * this replica.\n *\n * The transition is hardcoded and may vary from one to another OS versions. But it\n * seems like last time it has been changed in iOS 7. Since RN supports at least iOS\n * 11 it doesn't make sense to replicate iOS 7 behavior. If it changes in next OS\n * versions, then this implementation should be revisited and reflect necessary changes.\n *\n * @returns {height, progress} - animated values\n */\nexport const useReanimatedKeyboardAnimationReplica = () => {\n  const height = useSharedValue(0);\n  const heightEvent = useSharedValue(0);\n\n  const progress = useDerivedValue(() => height.value / heightEvent.value);\n\n  const handler = useCallback((_height: number) => {\n    \"worklet\";\n\n    heightEvent.value = _height;\n  }, []);\n\n  useAnimatedReaction(\n    () => ({\n      _keyboardHeight: heightEvent.value,\n    }),\n    (result, _previousResult) => {\n      const { _keyboardHeight } = result;\n      const _previousKeyboardHeight = _previousResult?._keyboardHeight;\n\n      if (_keyboardHeight !== _previousKeyboardHeight) {\n        height.value = withSpring(_keyboardHeight, IOS_SPRING_CONFIG);\n      }\n    },\n    [],\n  );\n\n  useEffect(() => {\n    const show = Keyboard.addListener(\"keyboardWillShow\", (e) => {\n      runOnUI(handler)(-e.endCoordinates.height);\n    });\n    const hide = Keyboard.addListener(\"keyboardWillHide\", () => {\n      runOnUI(handler)(0);\n    });\n\n    return () => {\n      show.remove();\n      hide.remove();\n    };\n  }, []);\n\n  return { height, progress };\n};\n\nexport const useGradualKeyboardAnimation =\n  Platform.OS === \"ios\"\n    ? useReanimatedKeyboardAnimationReplica\n    : useReanimatedKeyboardAnimation;\n"],"mappings":"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"}